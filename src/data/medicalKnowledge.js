/**
 * Medical Knowledge Base for RAG System
 * This contains general health information that the AI can reference
 */

export const medicalKnowledgeBase = [
  {
    id: 1,
    category: "VisiMedica Core",
    topic: "Precision Longevity Medicine",
    content: `VisiMedica is pioneering precision longevity medicine through state-of-the-art in-city clinics. 
    We combine advanced diagnostics (genomic sequencing, tissue analysis, cutting-edge imaging), precision therapeutics, 
    AI-driven nutrition, preventative wellness programs, and integrated aesthetics to maximize healthspan. 
    Our approach transforms healthcare from reactive to predictive and proactive, focusing on extending not just lifespan, 
    but vibrant, optimized healthspan.`
  },
  {
    id: 2,
    category: "VisiMedica Core",
    topic: "Digital Twin Technology",
    content: `The VisiMedica Digital Twin is a dynamic, high-fidelity virtual model of your biology built from comprehensive 
    biological data. It integrates advanced diagnostics, genetics, real-time physiological data, and continuous wearable inputs. 
    Our proprietary AI Engine analyzes this data to predict health trajectories, uncover hidden risks, identify patterns, 
    and create a personalized health optimization roadmap. Your Digital Twin evolves continuously, becoming an ever-more-accurate 
    blueprint for longevity and vitality.`
  },
  {
    id: 3,
    category: "VisiMedica Core",
    topic: "The 5-Stage VisiMedica Journey",
    content: `Your VisiMedica journey consists of 5 comprehensive stages to build your Digital Twin:
    
    Stage 1 - Personal Profile: Create your foundational health profile using our tablet-guided system with AI Companion assistance. 
    Basic information is pre-filled, then you'll complete sections on current supplements and medications, detail your exercise habits, 
    and provide a visual assessment of your dietary patterns. Dr. Chowdhury and our wider clinical team are available to assist.
    
    Stage 2 - Mind Assessment: Comprehensive cognitive and mental health evaluation including stress biomarkers, cognitive performance 
    testing, and psychological wellbeing assessment.
    
    Stage 3 - Body Composition: Advanced body composition analysis using cutting-edge imaging and measurement technologies to assess 
    muscle mass, fat distribution, bone density, and metabolic health markers.
    
    Stage 4 - Blood Analysis: Deep-dive blood work including comprehensive metabolic panels, hormone levels, nutrient status, 
    inflammatory markers, and biomarkers for longevity and disease prevention.
    
    Stage 5 - Genetic Blueprint: Genomic sequencing to understand your genetic predispositions, personalized medication responses, 
    disease risks, and optimization opportunities based on your unique DNA.
    
    All stages integrate seamlessly to create your comprehensive Digital Twin, enabling truly personalized precision medicine.`
  },
  {
    id: 16,
    category: "VisiMedica Core",
    topic: "Visi AI - Your Health Concierge",
    content: `Visi AI (Dr. Chowdhury) is your interactive health concierge, providing real-time insights and guidance based on your Digital Twin. 
    Available 24/7, Visi AI helps you understand your health data, answers questions about diagnostics and treatments, 
    schedules appointments, tracks your health journey, and provides personalized recommendations. During your 5-stage journey, 
    the AI Companion guides you through tablet-based assessments while Dr. Chowdhury and the clinical team remain available for support. 
    Visi AI transforms complex medical data into actionable insights, empowering you to make informed decisions about your health and longevity.`
  },
  {
    id: 4,
    category: "Services",
    topic: "Advanced Diagnostics",
    content: `VisiMedica offers comprehensive deep-dive diagnostics including: genomic sequencing to understand genetic predispositions, 
    advanced tissue analysis, cutting-edge medical imaging (MRI, CT, ultrasound), comprehensive blood panels, metabolic testing, 
    hormone analysis, microbiome assessment, and cardiovascular health screening. These diagnostics feed into your Digital Twin, 
    creating a complete picture of your current health status and future risk factors.`
  },
  {
    id: 5,
    category: "Services",
    topic: "Precision Therapeutics",
    content: `Our precision therapeutics are tailored to your unique biology based on your Digital Twin analysis. 
    Services include: personalized medication protocols, hormone optimization therapy, peptide treatments, IV nutrient therapy, 
    regenerative medicine, cellular therapies, and targeted supplementation. All treatments are evidence-based and continuously 
    adjusted based on your real-time health data and biomarker tracking.`
  },
  {
    id: 6,
    category: "Services",
    topic: "AI-Driven Nutrition",
    content: `VisiMedica's AI-driven nutrition program creates personalized meal plans based on your genetics, metabolic profile, 
    health goals, and real-time data from your Digital Twin. We analyze your nutrient absorption, food sensitivities, 
    metabolic responses, and microbiome composition to optimize your diet for longevity, performance, and disease prevention. 
    Continuous monitoring allows for dynamic adjustments as your body and goals evolve.`
  },
  {
    id: 7,
    category: "Services",
    topic: "Performance Optimization",
    content: `Our performance optimization programs enhance physical and cognitive function through: personalized exercise protocols, 
    sleep optimization strategies, stress management techniques, cognitive enhancement programs, recovery optimization, 
    and biohacking interventions. All programs are guided by your Digital Twin data and continuously refined based on 
    measurable outcomes and biomarker improvements.`
  },
  {
    id: 8,
    category: "Services",
    topic: "Cellular Aesthetics",
    content: `VisiMedica's cellular-level aesthetics go beyond traditional cosmetic treatments. We use regenerative medicine, 
    cellular therapies, advanced skincare protocols, and precision treatments to promote healthy aging from the inside out. 
    Our approach addresses the root causes of aging at the cellular level, combining aesthetic goals with overall health 
    and longevity optimization.`
  },
  {
    id: 9,
    category: "Common Symptoms",
    topic: "Headaches",
    content: `Headaches can range from tension headaches to migraines. At VisiMedica, we use your Digital Twin 
    to identify patterns and triggers. Common causes include stress, dehydration, lack of sleep, or eye strain. 
    Our AI can track headache frequency and correlate with lifestyle factors. Warning signs requiring immediate attention: 
    sudden severe headache, headache with fever/stiff neck, vision changes, or headache after head injury.`
  },
  {
    id: 10,
    category: "Common Symptoms",
    topic: "Cold and Flu",
    content: `Cold symptoms: runny nose, sore throat, cough, congestion. Usually lasts 7-10 days. 
    Flu symptoms: fever, body aches, fatigue, can last 1-2 weeks. VisiMedica's immune optimization protocols 
    can help prevent illness and speed recovery. Treatment: rest, hydration, over-the-counter medications. 
    Seek care if: breathing difficulty, persistent fever over 3 days, severe symptoms.`
  },
  {
    id: 11,
    category: "Preventive Care",
    topic: "Longevity Optimization",
    content: `VisiMedica's longevity optimization combines traditional wellness with cutting-edge science: 
    7-9 hours quality sleep (tracked via wearables), personalized nutrition based on your genetics, 
    150+ minutes exercise weekly (optimized for your biology), stress management through biofeedback, 
    regular comprehensive diagnostics, hormone optimization, and cellular health monitoring. Your Digital Twin 
    tracks all these factors to maximize healthspan.`
  },
  {
    id: 12,
    category: "Emergency Signs",
    topic: "When to Seek Immediate Care",
    content: `Seek emergency care for: chest pain/pressure, difficulty breathing, severe bleeding, 
    loss of consciousness, severe allergic reaction, stroke signs (FAST: Face drooping, Arm weakness, 
    Speech difficulty, Time to call 911), severe abdominal pain, high fever with rash, severe burns, 
    poisoning, or suicidal thoughts. VisiMedica's predictive analytics can help identify risk factors before emergencies occur.`
  },
  {
    id: 13,
    category: "Mental Health",
    topic: "Stress and Cognitive Optimization",
    content: `VisiMedica addresses mental health through our comprehensive approach: stress biomarker tracking, 
    cognitive performance optimization, personalized meditation protocols, hormone balance for mood regulation, 
    and nutritional psychiatry. Common stress symptoms: tension, irritability, sleep issues, difficulty concentrating. 
    Our Digital Twin identifies patterns and triggers, allowing for proactive intervention before burnout occurs.`
  },
  {
    id: 14,
    category: "Appointments",
    topic: "VisiMedica Clinic Experience",
    content: `Book appointments at our state-of-the-art in-city clinics or via virtual consultation 24/7. 
    Initial visit includes: comprehensive health assessment, advanced diagnostics, Digital Twin creation, 
    and personalized longevity roadmap. Follow-ups track progress, adjust protocols, and update your Digital Twin. 
    All data integrates seamlessly with Visi AI for continuous guidance between appointments.`
  },
  {
    id: 15,
    category: "Common Symptoms",
    topic: "Digestive Issues",
    content: `VisiMedica's approach to digestive health includes microbiome analysis, food sensitivity testing, 
    and metabolic profiling. Common issues: acid reflux, bloating, constipation, diarrhea. Our AI-driven nutrition 
    program identifies trigger foods and optimizes your diet for gut health. Management: fiber-rich diet, hydration, 
    smaller meals. Seek care for: severe pain, blood in stool, persistent symptoms over 2 weeks, unexplained weight loss, 
    or difficulty swallowing.`
  },
  {
    id: 10,
    category: "Chronic Conditions",
    topic: "Diabetes Management",
    content: `Diabetes requires ongoing monitoring: regular blood sugar checks, medication adherence, 
    healthy diet (limit simple carbs), regular exercise, foot care, eye exams, A1C tests every 3-6 months. 
    Warning signs: extreme thirst, frequent urination, blurred vision, slow-healing wounds. 
    We offer diabetes education and management programs.`
  }
];

/**
 * Simple text similarity function for RAG retrieval
 * @param {string} query - User's question
 * @param {string} text - Knowledge base text
 * @returns {number} - Similarity score
 */
function textSimilarity(query, text) {
  const queryLower = query.toLowerCase();
  const textLower = text.toLowerCase();
  
  // Count matching words
  const queryWords = queryLower.split(/\s+/).filter(w => w.length > 3);
  const textWords = new Set(textLower.split(/\s+/));
  
  let matches = 0;
  queryWords.forEach(word => {
    if (textWords.has(word)) matches++;
  });
  
  // Also check for substring matches
  if (textLower.includes(queryLower)) matches += 10;
  
  return matches;
}

/**
 * Retrieve relevant knowledge for RAG
 * @param {string} query - User's question
 * @param {number} topK - Number of results to return
 * @returns {Array} - Relevant knowledge entries
 */
export function retrieveRelevantKnowledge(query, topK = 3) {
  const scored = medicalKnowledgeBase.map(entry => ({
    ...entry,
    score: textSimilarity(query, entry.topic + ' ' + entry.content)
  }));
  
  // Sort by score and return top K
  return scored
    .sort((a, b) => b.score - a.score)
    .slice(0, topK)
    .filter(entry => entry.score > 0);
}
